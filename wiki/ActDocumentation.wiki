#summary Documentation about the ACT format
#labels ACTFormat

= Origin =

ACT is a low complexity speech compression codec. There are 3 different ways to record to this codec from a player.

    * Fine Rec
    * Long Rec
    * Long Vox, in this mode the player will just record if there is anything to record. 

|| *Name* || *Sample rate* || *Frame size* || *Frames per chunk* || *Chunk size* || *Padding bytes* ||
|| Fine Rec || 8000 || 10 || 51 || 510 || 2 ||
|| Long Rec || 4400 || 22 || 23 || 506 || 6 ||
|| Long Vox || 4400 || 22 || 23 || 506 || 6 ||
*Table 1. Known Formats*

The codec actually is G729 (or even G729A)

= ACT File Format =

Files are always aligned to 512 bytes boundary and contains 512 byte header and chunks of the same size. Each chunk consists of fixed number of frames and padding bytes (see Table 1).

|| *Name* || *Offset* || *Bytes* || *Description* ||
|| riff tag || 0 || 4 || 'RIFF' ||
|| riff size || 4 || 4 || `data_size + 36` ||
|| wave tag || 8 || 4 || 'WAVE' ||
|| fmt tag || 12 || 4 || 'fmt ' ||
|| wave header size || 16 || 4 || Always 0x10 ||
|| wave format || 20 || 2 || PCM's 0x01 ||
|| channels || 22 || 2 || 0x01 ||
|| sample rate || 24 || 4 || 8000 or 4400 ||
|| bit rate || 28 || 4 || 16000 or ? ||
|| block align || 32 || 2 || Always 0x02 ||
|| bits per sample || 34 || 2 || Always 16 ||
|| data_tag || 36 || 4 || 'data' ||
|| data_size || 40 || 4 || `chunks_count *  8 * chunk_size`^1^ ||
|| reserved || 44 || 212 || filled by zero ||
|| act tag || 256 || 1 || Always 0x84 ||
|| millisec || 257 || 2 || milliseconds part of duration value ||
|| seconds || 259 || 1 || seconds part of duration value ||
|| minutes || 260 || 4 || minutes part of duration value ||
|| reserved || 264 || 248 || filled by zero ||
*Table 2. ACT header*

^1^ chunk_size is determined from Table 1.

== ACT Frame format ==
First half of ACT frame contains odd bytes, while the second contains even bytes of encoded G729 frame.
{{{
for(i=0 ; i<frame_size/2; i++)
{
  g729_data[2*i]=act_data[i]
  g729_data[2*i+1]=act_data[frame_size/2+i]
}
}}}

== G.729 Codec ==

|| *Symbol* || *Description* || *Bits (Fine rec)* || *Bits (Long Rec/Long vox)* ||
|| L0 || Switched MA predictor of LSP quantizer || 1 || 1 ||
|| L1 || First stage vector of quantizer || 7 || 7 ||
|| L2 || Second stage lower vector of LSP quantizer || 5 || 5 ||
|| L3 || Second stage higher vector of LSP quantizer || 5 || 5 ||
|| P1 || Pitch delay first subframe || 8 || 8 ||
|| P0 || Parity bit for Pitch delay || 1 || 1 ||
|| C1 || Fixed codebook first subframe || 13 || 12 ||
|| S1 || Signs of fixed-codebook pulses 1st subframe || 4 || 9 ||
|| GA1 || Gain codebook (stage 1) 1st subframe || 3 || 3 ||
|| GB1 || Gain codebook (stage 1) 1st subframe || 4 || 4 ||
|| P2 || Pitch delay second subframe || 5 || 5 ||
|| C2 || Fixed codebook 2nd subframe || 13 || 12 ||
|| S2 || Signs of fixed-codebook pulses 2nd subframe || 4 || 9 ||
|| GA2 || Gain codebook (stage 1) 2nd subframe || 3 || 3 ||
|| GB2 || Gain codebook (stage 1) 2nd subframe || 4 || 4 ||
|| || *Total* || *80* || *88*^2^ ||
*Table 3. Description of transmitted parameters indices*^1^

^1^Note: the bitstream ordering is reflected by order in the table. For each parameter, the Most Significant Bit (MSB) is transmitted first.

^2^ Two G.729 frames are passed from demuxer to codec at one time

= Proprietary software =

||*Offset*|| *Function*^1^ || *Description* ||
||0x00401000|| !ReadHeader || Read ACT Header||
||0x00401030|| ReadACTFrame || Reads one (two for Long Rec/Vox) frame to buffer ||
||0x00401130|| !SkipRiffHeader || ||
||0x00401150|| !WriteRiffHeader|| Writes Riff header to decoded WAV file||
||0x00401280|| !InitCodecParams || Initializes codec||
||0x00407C90|| ACT2WavConvert|| Main convertion routine (loop) ||
||0x004029E0|| DecodeACTFrame || G.729 decoder ||
*Table 4. Proprietary decoder functions*

^1^ Functions names are guessed

||*Offset*|| *Function* || *Description* ||
||0x004013A0|| sature || ||
||0x004013F0|| add ||  ||
||0x00401410|| sub || ||
||0x00401430|| shl || ||
||0x004014A0|| shr || ||
||0x004014F0|| mult || ||
||0x00401520|| L_mult || ||
||0x00401550|| negate || ||
||0x00401570|| extract_h || ||
||0x00401580|| extract_l || ||
||0x00401590|| round || ||
||0x004015B0|| L_mac || ||
||0x004015D0|| L_msu || ||
||0x004015F0|| L_add || ||
||0x00401630|| L_sub || ||
||0x00401670|| L_shl || ||
||0x004016D0|| L_shr || ||
||0x00401710|| L_deposit_h || ||
||0x00401720|| L_deposit_l || ||
||0x00401730|| L_shr_r || ||
||0x00401770|| div_s || ||
||0x00401820|| norm_l || ||
*Table 4. Routines which were got from ITU's reference decoder (BASIC_OP.C)*


= Links =
  * [http://wiki.multimedia.cx/index.php?title=ACT ACT Page on wiki.multimedia.cx]
  * [http://amv-codec-tools.googlecode.com/files/G.729_e.pdf ITU G.729 Specification]
  * [http://samples.mplayerhq.hu/A-codecs/act/ Samples]
  * [http://www.netac.com/Download/C635/C635%20Driver&Tools.zip Working decoder]